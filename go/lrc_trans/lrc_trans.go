package main

import (
	"fmt"
	"regexp"
	"strings"
)

func main() {
	qrc := `<?xml version="1.0" encoding="utf-8"?>
<QrcInfos>
<QrcHeadInfo SaveTime="206" Version="100"/>
<LyricInfo LyricCount="1">
<Lyric_1 LyricType="1" LyricContent="[ti:왜]
[ar:빈 (VIN)]
[al:왜]
[by:]
[offset:0]
[0,1730]왜(0,157) (157,157)-(314,157) (471,158)빈(629,157) (786,157)((943,157)Vin(1100,472))(1572,158)
[1730,1730]词(1730,346)：(2076,346)김(2422,346)준(2768,346)희(3114,346)
[3460,1730]曲(3460,346)：(3806,346)김(4152,346)준(4498,346)희(4844,346)
[5190,1740]编(5190,290)曲(5480,290)：(5770,290)배(6060,290)형(6350,290)호(6640,290)
[6935,5188]선선한 (6935,730)바람 (7665,792)불던 (8457,1768)그날 (10225,552)밤(10777,752)
[12123,7814]달빛이 (12123,886)길을 (13009,874)밝혀 (13883,868)주던 (14751,571)날(15322,903)
[19937,5227]너와 (19937,496)마주 (20433,696)잡던 (21129,888)두 (22017,1304)손이(23321,1088)
[25164,7900]떨어지고 (25164,1638)나에게 (26802,942)말했지(27744,2072)
[33064,4928]이미 (33064,513)예상했던 (33577,1535)걸까(35112,1104)
[37992,3816]걷는 (37992,494)내내 (38486,658)어색한 (39144,1419)공기를(40563,1125)
[41808,4104]느꼈던 (41808,1144)걸까(42952,1440)
[45912,6512]네가 (45912,682)남기고 (46594,1214)간 (47808,432)차가운 (48240,792)향기만(49032,2659)
[52424,5712]보이지 (52424,1352)않는 (53776,992)너의 (54768,592)뒷모습만(55360,2312)
[58136,6480]왜 (58136,1032)떠날 (59168,712)사람에게 (59880,1644)난 (61524,1212)자꾸(62736,1440)
[64616,6640]이름조차 (64616,1386)부르지 (66002,1188)못하는데(67190,1754)
[71256,6560]왜 (71256,1008)떠날 (72264,721)사람에게 (72985,1687)난 (74672,1272)자꾸(75944,1464)
[77816,7918]미련만 (77816,965)갖게 (78781,795)되는데(79576,2802)
[85734,13492]즐겁지 (85734,1221)않나 (86955,567)봐 (87522,1826)중요하지 (92391,1093)않나 (93484,656)봐(94140,1342)
[99226,4942]눈치챈 (99226,808)걸까 (100034,889)나의 (100923,823)두 (101746,578)눈을(102324,1534)
[104168,6585]보란 (104168,508)듯이 (104676,1046)이별을 (105722,912)고해요(106634,3192)
[110753,6496]왜 (110753,1121)떠날 (111874,727)사람에게 (112601,1506)난 (114107,1161)자꾸(115268,1541)
[117249,6664]이름조차 (117249,1640)부르지 (118889,872)못하는데(119761,1904)
[123913,6464]왜 (123913,1074)떠날 (124987,654)사람에게 (125641,1608)난 (127249,1232)자꾸(128481,1440)
[130377,7680]미련만 (130377,944)갖게 (131321,896)되는데(132217,2848)
[138057,5616]오늘도 (138057,1048)난 (139105,328)너 (139433,464)없는 (139897,560)방안에 (140457,1457)앉아(141914,871)
[143673,7530]네 (143673,1216)웃는 (144889,432)모습 (145321,1584)그려(146905,1400)
[151203,6384]끝내 (151203,648)멀어진 (151851,1599)너를 (153450,1689)다시(155139,1512)
[157587,5728]돌릴 (157587,904)순 (158491,344)없을까(158835,4008)
[163315,6542]날 (163315,904)사랑 (164219,760)안 (164979,440)해도 (165419,688)돼 (166107,463)더 (166570,1400)이상(167970,1567)
[169857,6963]저만치 (169857,784)너만 (170641,856)바라볼 (171497,1192)수 (172689,633)있게 (173322,703)해줄래(174025,1992)
[176820,6176]노력해볼게 (176820,2471)우리의 (179291,888)마지막을(180179,2401)
[182996,10631]아름답게 (182996,1656)추억할 (184652,895)수 (185547,1161)있게(186708,2408)
[193627,5240]왜 (193627,1120)떠날 (194747,632)사람에게 (195379,1864)난(197243,1522)
"/>
</LyricInfo>
</QrcInfos>`

	fmt.Println(TransLyric2Txt(qrc))
}

func TransLyric2Txt(lyricRaw string) string {
	offsetLabel := "[offset:0]"
	idx := strings.Index(lyricRaw, offsetLabel)
	if idx >= 0 {
		lyricRaw = lyricRaw[idx+len(offsetLabel):]
	}
	regArr := []string{
		`\<\d+\>`,
		`\[\d+:\d+.\d+\]`,
		`\<\d+,\d+,\d+\>`,
		`\[\d+,\d+\]`,
		`\[\d+:\d+.\d+\]`,
		`\(\d+,\d+\)`,
		`\<[-+]?\d+,[-+]?\d+\>`,
	}
	reg := regexp.MustCompile(strings.Join(regArr, `|`))
	lyricRaw = reg.ReplaceAllString(lyricRaw, "")
	lyricRaw = strings.TrimSpace(lyricRaw)

	lyricRaw = strings.ReplaceAll(lyricRaw, "\\n", "\n")
	lyricRaw = strings.ReplaceAll(lyricRaw, "\\r", "\r")
	lyricRaw = strings.ReplaceAll(lyricRaw, `\n`, "\n")
	lyricRaw = strings.ReplaceAll(lyricRaw, `\r`, "\r")
	endLabel := "</LyricInfo>"
	endIdx := strings.Index(lyricRaw, endLabel)
	if endIdx > 4 {
		lyricRaw = lyricRaw[:endIdx-4]
	}
	return lyricRaw
}
